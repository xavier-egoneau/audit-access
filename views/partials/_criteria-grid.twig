<div class="container-fluid">
    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Critère</th>
                                <th>Niveau <small>WCAG</small></th>
                                <th>Description</th>
                                <th>État</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>

    {% for section in criteria %}


            <tr >
                <td>{{ section.id}}</td>
                <td></td>
                <td> {{ section.titre }}</td>
                <td></td>
                <td></td>
            </tr>
            {% for sousSection in section.sousSections %}


                    <tr >
                        <td>{{ sousSection.id }}</td>
                        <td></td>
                        <td > {{ sousSection.titre }}</td>
                        <td></td>
                        <td></td>
                    </tr>
                    
                            {% for criterion in sousSection.criteres %}
                                <tr class="statut statut-{{ criterion.status }}">
                                    <td>{{ criterion.id }}</td>
                                    <td>{{ criterion.niveauWCAG }}</td>
                                    <td>{{ criterion.titre }}</td>
                                    
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <select class="form-select form-select-sm criterion-status me-2"
                                                    data-criterion="{{ criterion.id }}">
                                                <option value="NT" {% if criterion.status == 'NT' %}selected{% endif %}>Non Testé</option>
                                                <option value="NA" {% if criterion.status == 'NA' %}selected{% endif %}>Non Applicable</option>
                                                <option value="C" {% if criterion.status == 'C' %}selected{% endif %}>Conforme</option>
                                                <option value="NC" {% if criterion.status == 'NC' %}selected{% endif %}>Non Conforme</option>
                                                {% if not currentPage and criterion.hasDifferentStatuses %}
                                                    <option value="MULTIPLE" {% if criterion.status == 'MULTIPLE' %}selected{% endif %} disabled>Statuts multiples</option>
                                                {% endif %}
                                            </select>
                                            {% if criterion.hasDifferentStatuses %}
                                                <span class="badge bg-warning" 
                                                    data-bs-toggle="tooltip" 
                                                    title="Les statuts diffèrent selon les pages">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="audit-actions">
                                        <button class="btn btn-primary open_NC" 
                                                data-bs-toggle="collapse" 
                                                data-bs-target="#collapse-{{ criterion.id|replace({'.': '-'}) }}">
                                            Voir NC
                                        </button>
                                        <button class="btn btn-primary" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#test-modal_{{criterion.id|replace({'.': '-'})}}">
                                            Méthodologie
                                        </button>
                                    </td>
                                </tr>
                                {# Ligne collapsable pour les NC - reste inchangé #}
                                {% include 'partials/_nc-collapse.twig' with {'criterion': criterion} %}
                                
                            {% endfor %}
                       
            {% endfor %}
       
    {% endfor %}
        </tbody>
    </table>
</div>

{# Dans _criteria-grid.twig, après la table existante #}

{# Ajouter les modales de méthodologie pour chaque critère #}
{% for section in criteria %}
    {% for sousSection in section.sousSections %}
        {% for criterion in sousSection.criteres %}
            <div class="modal fade" id="test-modal_{{criterion.id|replace({'.': '-'})}}" tabindex="-1" role="dialog" aria-labelledby="methodologie-{{criterion.id|replace({'.': '-'})}}" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="methodologie-{{criterion.id|replace({'.': '-'})}}">
                                Méthodologie de test - Critère {{criterion.id}}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <h6>Tests à réaliser :</h6>
                            <ol>
                                {% for etape in criterion.methodologie %}
                                    <li>{{ etape }}</li>
                                {% endfor %}
                            </ol>
                            
                            {% if criterion.notes %}
                                <h6>Notes :</h6>
                                <div>{{ criterion.notes }}</div>
                            {% endif %}
                            
                            {% if criterion.casParticuliers %}
                                <h6>Cas particuliers :</h6>
                                <div>{{ criterion.casParticuliers }}</div>
                            {% endif %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endfor %}
{% endfor %}